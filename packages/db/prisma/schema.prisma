// Canonical Prisma schema for the monorepo shared DB package
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Use the same env var as the existing app for compatibility
  url = env("POSTGRES_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

enum TransactionDirection {
  IN
  OUT
}

model PoliticalOrganization {
  id           Int           @id @default(autoincrement())
  name         String
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions MfTransaction[]

  @@map("political_organizations")
}

model Politician {
  id           Int           @id @default(autoincrement())
  slug         String        @unique
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model Transaction {
  id              Int                   @id @default(autoincrement())
  politicianId    Int
  politician      Politician            @relation(fields: [politicianId], references: [id], onDelete: Cascade)
  date            DateTime
  value           Int
  direction       TransactionDirection
  // Outgoing-specific fields
  method          String?               // e.g., card, cash
  category        String?
  category1       String?
  category2       String?
  // Incoming-specific fields
  counterparty    String?               // e.g., who
  inflowType      String?               // e.g., personal, corporate
  source          String?               // e.g., stripe, bank
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([politicianId, direction])
  @@index([date])
}

model MfTransaction {
  id                      Int                     @id @default(autoincrement())
  politicalOrganizationId Int
  politicalOrganization   PoliticalOrganization   @relation(fields: [politicalOrganizationId], references: [id], onDelete: Cascade)
  transactionNo           Int                     @unique
  date                    DateTime

  debitAccount       String?
  debitSubaccount    String?
  debitDepartment    String?
  debitCounterparty  String?
  debitTaxCategory   String?
  debitInvoice       String?
  debitAmountYen     Int?

  creditAccount      String?
  creditSubaccount   String?
  creditDepartment   String?
  creditCounterparty String?
  creditTaxCategory  String?
  creditInvoice      String?
  creditAmountYen    Int?

  summary            String?
  tags               String?
  memo               String?
  note1              String?
  note2              String?
  note3              String?
  summaryDetail      String?

  direction          TransactionDirection

  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt

  @@index([date])
  @@index([direction])
  @@index([politicalOrganizationId])
  @@map("mf_transactions")
}
