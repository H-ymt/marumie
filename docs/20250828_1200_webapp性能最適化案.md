# webapp 性能最適化案

## 現状の問題

Google Speed Insight での測定結果：
- **First Contentful Paint**: 1.2秒
- **Largest Contentful Paint**: 4.4秒（遅い）
- **Total Blocking Time**: 390ms（改善必要）
- **Speed Index**: 5.6秒（遅い）

### 主要な問題点
1. **CSS ファイル分割による読み込み遅延**: 3つのCSSファイル（計42KB）が個別にロードされ、LCP/FCPを遅延
2. **不要なJavaScript Polyfill**: 19.9KB の不要な polyfill が含まれている（ES2017対応）

## 最適化案

### 1. TypeScript Target のアップデート（高効果・低リスク）

**現状**: `webapp/tsconfig.json:3`
```json
"target": "ES2017"
```

**変更案**:
```json
"target": "ES2022"
```

**効果**: 
- 19.9KB の polyfill 削除
- 以下のpolyfillが不要になる：
  - Array.prototype.at
  - Array.prototype.flat/flatMap
  - Object.fromEntries/hasOwn
  - String.prototype.trimStart/trimEnd
  - @babel/plugin-transform-classes
  - @babel/plugin-transform-spread
  - Object.assign

### 2. Next.js 設定最適化（中効果・低リスク）

**ファイル**: `webapp/next.config.ts`

**追加設定**:
```typescript
const nextConfig: NextConfig = {
  experimental: {
    optimizeCss: true,
  },
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
  // 既存のheaders設定...
};
```

**効果**:
- CSS の最適化とinline化
- 本番環境でのconsole.log除去

### 3. CSS 最適化戦略（中効果・中リスク）

**現状問題**:
- 3つのCSSファイルが個別ロード（42.0KB + 32.3KB + 2.4KB + 7.3KB）
- レンダリングブロッキング

**対策案**:
- Critical CSS のinline化
- 非Critical CSS の遅延読み込み

## 期待される効果

| 指標 | 現在 | 改善後予測 | 改善幅 |
|------|------|------------|--------|
| LCP | 4.4秒 | 2.5-3.0秒 | -1.4〜1.9秒 |
| TBT | 390ms | 150-200ms | -190〜240ms |
| Speed Index | 5.6秒 | 3.5-4.0秒 | -1.6〜2.1秒 |

## 実装優先度

### Phase 1: 即座に実装可能（低リスク）
1. TypeScript target を ES2022 に変更
2. Next.js compiler 設定追加

### Phase 2: 慎重に実装（要テスト）
1. CSS 最適化設定の有効化
2. パフォーマンス測定・検証

## 実装上の注意点

- ES2022 への変更前に、サポート対象ブラウザとの互換性確認が必要
- 本番環境でのA/Bテストを推奨
- 変更後は必ずSpeed Insightで効果測定を実施

## 次のステップ

1. 開発環境での変更実装
2. ローカルでのビルド確認
3. ステージング環境でのパフォーマンステスト
4. 本番デプロイ・効果測定