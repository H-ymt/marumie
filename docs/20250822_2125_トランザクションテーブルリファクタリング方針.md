# トランザクションテーブルリファクタリング方針

## 概要
現在のトランザクションテーブルコンポーネントをリファクタリングし、セマンティックHTMLへの移行とモバイル対応を段階的に実装する。

## 現状の課題

### 1. セマンティックHTMLの欠如
- 現在はdiv要素でテーブルを構成
- スクリーンリーダーがテーブルとして認識できない
- SEO的に表形式データとして認識されない
- アクセシビリティが低い

### 2. モバイル対応の不足
- デスクトップ向けのレイアウトのみ
- モバイルでのソート機能のUXが不適切
- Figmaデザインのタブ切り替え式UIが未実装

## 実装方針

### フェーズ1: セマンティックHTML化（リファクタリング）

#### 対象コンポーネント
- `TransactionTableHeader.tsx`
- `TransactionTableRow.tsx`
- 親コンポーネント（テーブル全体を管理）

#### 実装内容
1. **HTML構造の変更**
   ```html
   <!-- 現在 -->
   <div className="bg-white">
     <div className="flex items-center">...</div>
   </div>

   <!-- 変更後 -->
   <table className="w-full bg-white">
     <thead>
       <tr>
         <th>日付</th>
         <th>項目項目</th>
         <th>金額</th>
         <th>カテゴリー</th>
       </tr>
     </thead>
     <tbody>
       <tr>
         <td>...</td>
       </tr>
     </tbody>
   </table>
   ```

2. **スタイリングの調整**
   - Flexboxからtableレイアウトへの移行
   - 既存のデザインを維持しながらtable要素でスタイリング
   - レスポンシブ対応の準備

3. **アクセシビリティの向上**
   - `scope`属性の追加
   - 適切な`aria-label`の設定
   - ソート可能な列への`aria-sort`属性追加

### フェーズ2: モバイルヘッダー実装

#### Figmaデザイン仕様
- タブ切り替え式のソート選択
- 4つのオプション：
  - 新しい順（date-desc）
  - 古い順（date-asc）
  - 価格が高い順（amount-desc）
  - 価格が安い順（amount-asc）
- アクティブタブの視覚的フィードバック（下線、色変更）

#### 実装アプローチ

1. **新コンポーネントの作成**
   ```typescript
   // TransactionTableMobileHeader.tsx
   interface TransactionTableMobileHeaderProps {
     onSortChange: (sortOption: SortOption) => void;
     currentSort: SortOption;
   }
   ```

2. **レスポンシブ切り替え**
   ```tsx
   // 親コンポーネント
   <>
     {/* モバイル用タブヘッダー（768px未満で表示） */}
     <div className="block md:hidden">
       <TransactionTableMobileHeader />
     </div>
     
     {/* テーブル */}
     <table>
       {/* デスクトップ用ヘッダー（768px以上で表示） */}
       <thead className="hidden md:table-header-group">
         ...
       </thead>
       <tbody>...</tbody>
     </table>
   </>
   ```

3. **タブUIの実装**
   - 横スクロール対応（オプション数が増えた場合）
   - タッチフレンドリーなタップ領域
   - スムーズなアニメーション

## 型定義の統一

```typescript
// types/transaction.ts
export type SortField = 'date' | 'amount';
export type SortOrder = 'asc' | 'desc';
export type SortOption = 'date-desc' | 'date-asc' | 'amount-desc' | 'amount-asc';

export interface SortState {
  field: SortField;
  order: SortOrder;
}

// ユーティリティ関数
export const sortOptionToState = (option: SortOption): SortState => {
  const [field, order] = option.split('-') as [SortField, SortOrder];
  return { field, order };
};

export const stateToSortOption = (state: SortState): SortOption => {
  return `${state.field}-${state.order}` as SortOption;
};
```

## テスト計画

### ユニットテスト
- [ ] セマンティックHTML構造の確認
- [ ] ソート機能の動作確認
- [ ] レスポンシブ切り替えの確認

### アクセシビリティテスト
- [ ] スクリーンリーダーでの読み上げ確認
- [ ] キーボードナビゲーション
- [ ] WCAG 2.1準拠の確認

### ビジュアルテスト
- [ ] デスクトップ表示の確認
- [ ] モバイル表示の確認
- [ ] タブ切り替えアニメーション

## 実装スケジュール

1. **Step 1**: セマンティックHTML化の設計確定
2. **Step 2**: TransactionTableHeaderのリファクタリング
3. **Step 3**: TransactionTableRowのリファクタリング
4. **Step 4**: 親コンポーネントの調整
5. **Step 5**: モバイルヘッダーコンポーネントの実装
6. **Step 6**: レスポンシブ切り替えの実装
7. **Step 7**: テストとバグ修正

## 注意事項

- 既存の機能を壊さないよう段階的に実装
- デザインの変更は最小限に抑える
- パフォーマンスへの影響を監視
- コードの可読性とメンテナンス性を重視

## 参考資料

- [Figmaデザイン](https://www.figma.com/design/c0SjX5g781flssTg68DxoZ/Mirai-Open-Data?node-id=101-4634)
- [MDN: HTML table basics](https://developer.mozilla.org/en-US/docs/Learn/HTML/Tables/Basics)
- [WAI-ARIA: Table](https://www.w3.org/WAI/ARIA/apg/patterns/table/)