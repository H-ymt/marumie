# みらいまる見え政治資金の技術的バックグラウンドをご紹介

はじめまして。
チームみらい 永田町エンジニアチームの伊藤淳と申します。

先日チームみらいでは、政治資金の流れを透明性を持って公開するプラットフォーム[「みらい まる見え政治資金」](https://marumie.team-mir.ai)をリリースし、また[ソースコードを OSS として公開](https://github.com/team-mirai-volunteer/marumie)し、大きな反響をいただきました。

なぜチームみらいがこのサービスを公開するのかについては、別の記事(公開後にリンクを貼る)に譲るとして、この記事では、どのような技術・作り方でこのサービスが作られたかについてご紹介しようと思います。

このツールは、現時点でコード量としては約 15000 行と、「中規模」くらいのアプリケーションと言えるかなと思いますが、体感コードの 95%以上は LLM によって書かれています。

## みらい まる見え政治資金とは

### 政治とカネ問題を、モラルではなく仕組みで解決する

2024年、政治資金問題が大きな社会問題となりました。多くの報道は「政治家のモラル」を問い、多くの政治家は「襟を正す」と答えました。

しかし、本当にモラルの問題だったのでしょうか？

現在の政治資金報告書は、年に一度、紙やPDFで公開されます。複雑な勘定科目と専門用語が並び、一般市民はもちろん、当の政治家本人ですら「全体でいくら使ったのか」「今月はいくら残っているのか」を把握しづらい構造になっています。透明性を担保するはずの制度が、実質的には「誰も見ない・見られない」ブラックボックスと化していました。

問題の本質は、**見ようとしても見られない仕組み**にあったのです。

### 誰もが当事者になれる透明性を

チームみらいは、初登庁から100日以内に「政治とカネの見える化」を実現することを有権者に約束しました。その答えが、この「みらい まる見え政治資金」です。

このサービスは、クラウド会計ソフト（MFクラウド・freee等）に記帳した会計データを、リアルタイムでWebダッシュボードとして公開します。年に一度のPDFではなく、毎日更新される生きたデータとして。専門用語の羅列ではなく、キャッシュフロー図や月次グラフとして。

議員本人は「今月いくら使ったか」を毎日確認できます。事務担当者は複雑な政治資金報告書を、クラウド会計から短時間で作成できます。そして市民は、政党のカネの流れをリアルタイムでモニタリングし、1件1件の支出の妥当性を検証できます。

(サービスのスクショを入れる)

### 一つの政党から、日本の政治全体へ

このサービスのソースコードは、AGPL-3.0ライセンスでOSS公開されています。

「透明性」を、特定の政党だけの美徳ではなく、**日本の政治インフラ**にしたいからです。どの政党も、どの政治家も、このツールを使えば同じように透明性を確保できる。モラルに頼らず、仕組みで解決する。それが、この取り組みの本質です。


## サービス構成

みらい まる見え政治資金は、Next.js + Vercel + Supabase という、モダンで標準的な構成を採用しています。ただし、特定のBaaS（Backend as a Service）に過度に依存しないよう、後述するようなアーキテクチャ上の工夫を施しています。

### 技術スタック

- **フロントエンド**: Next.js 14 (App Router)
- **ホスティング**: Vercel
  - webapp（一般公開用）と admin（管理画面）を別の Vercel アプリケーションとして分離
- **データベース**: Supabase (PostgreSQL)
  - Repository 層に Interface を挟むことで、BaaS への依存を抽象化
  - 将来的な移行や他団体への展開も見据えた設計

### 高速化・最適化戦略

公開されている政治資金データは、頻繁に更新されるものではありません。また、多くのユーザーに同じデータを表示する性質上、キャッシュ戦略が非常に有効です。

**二重のキャッシュ戦略**

1. **ページレイヤーのキャッシュ**: Next.js の ISR（Incremental Static Regeneration）を活用し、ページ全体を静的に生成
2. **データ取得レイヤーのキャッシュ**: fetch の revalidate オプションを活用し、データ取得処理自体もキャッシュ

この戦略により、以下のメリットを実現しています：

- **高速なページ表示**: 静的生成されたページはCDNから配信され、初回表示が非常に高速
- **サーバー負荷の軽減**: 同じデータへのリクエストは、キャッシュから返却されるため DB アクセスが最小限に
- **クローラーフレンドリー**: 検索エンジンのクローラーにも完全な HTML が返されるため、SEO 対策も万全

**データ取得は極力 RSC（React Server Components）に**

Next.js の App Router では、デフォルトでサーバーコンポーネントとして動作します。この特性を最大限活用し、データ取得処理は可能な限りサーバーサイドで完結させています。

- クライアントサイドでの fetch は原則として行わない（リアルタイム性が必要な部分を除く）
- 各ページに対して単一のエンドポイント（loader）を用意し、必要なデータをまとめて取得する BFF パターンを採用
- 動的な fetch を排除することで、描画の高速化とクローラー対応を両立

この構成により、JavaScript が無効化されたブラウザでも基本的なコンテンツが閲覧可能になっており、アクセシビリティの向上にも寄与しています。

## LLM に 95%を任せるための工夫

### 工夫 ①: CLAUDE.md の設計

まず、
